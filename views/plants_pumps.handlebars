<!--- Credit to https://www.w3schools.com/HTML/html5_draganddrop.asp --->
<script>
function allowDrop(ev){
	ev.preventDefault();
}

function drag(ev) {
	//console.log(ev.target);
	//console.log(ev.target.getAttribute('value'));
	//console.log(ev.target.id);
	let obj = {value: ev.target.getAttribute('value'), type: ev.target.getAttribute('type')};
	ev.dataTransfer.setData("text", JSON.stringify(obj));
}

function drop(ev) {
	ev.preventDefault();
	var type = ev.target.getAttribute('title');
	var obj = JSON.parse(ev.dataTransfer.getData("text"));
	var data = obj.value;
	var obj_type = obj.type;
	if(type === obj_type){
		ev.target.textContent = data;
		//ev.target.setAttribute('value', data);
	}else{
		console.log(type);
		console.log(obj_type);
	}
}

function addRelationship(ev) {
	var plant = document.getElementById("plant_input").textContent;
	var pump = document.getElementById("pump_input").textContent;

	if(isNaN(parseInt(plant)) || isNaN(parseInt(pump))){
		return;
	}
    var postRequest = new XMLHttpRequest();
    var URL = '/input_pp';
    postRequest.open('POST', URL);
    var reqBody = JSON.stringify({
        plant_id: plant,
        pump_id: pump
    });

    postRequest.setRequestHeader('Content-Type', 'application/json');
    /*postRequest.addEventListener('load', function (event){
        if (event.target.status === 200) {
            //var template = Handlebars.templates.definitions;
            var Content = {
                question: fish,
                answer: feed
            };
            var cardHTML = Handlebars.templates.definitions(Content);
            var container = document.getElementsByClassName("flashcard-definitions");
            container[0].insertAdjacentHTML('beforeend', cardHTML);
            //addFlashCardDelete();
        }else{
            alert("Error adding flashcard to server: " + event.target.response);
        }
    });*/
    postRequest.send(reqBody);

}

</script>
<main class="temp_content">
	<h1>Plants and Pumps</h1>

	<div id="Lists">
	<div class="Objects" style="overflow-y: scroll;">
		<h2>Plants</h2>
		<table>
		<thead>
			<tr>
				<th>ID</th>
				<th>Species</th>
				<th>Tank ID</th>
			</tr>
		</thead>
		<tbody>
		{{#each data.Plants}}
			{{>plant_data_m}}
		{{/each}}
		</tbody>
		</table>
	</div>


<!-- <i class="move fas fa-random fa-rotate-90 fa-10x"></i> -->

	<div class="objects" style="overflow-y: scroll;">
		<h2>Pumps</h2>
		<table>
		<thead>
			<tr>
				<th>ID</th>
				<th>Flow Rate</th>
				<th>Age</th>
			</tr>
		</thead>
		<tbody>
		{{#each data.Pumps}}
			{{>pump_data_m}}
		{{/each}}
		</tbody>
		</table>

	</div>
	</div>
	<br>

	

	<div id="Plants_Pumps">
		<h2>Relationships</h2>
		<table>
		<thead>
			<tr>
				<th class="static">plant_id</th>
				<th class="static">pump_id</th>
				<th class="static">delete/add</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td id="plant_input" class="input" ondrop="drop(event)" ondragover="allowDrop(event)" title="Plant">Drag Plant Here</td>
				<td id="pump_input" class="input" ondrop="drop(event)" ondragover="allowDrop(event)" title="Pump">Drag Pump Here</td>
				<td class="add" onclick="addRelationship(event)"><button type="button"><i class="fas fa-plus"></i></button></td>
			</tr>
		{{#each data.PP}}
			{{>pp_relationship}}
		{{/each}}
		</tbody>
		</table>
	</div>
 
</main>
